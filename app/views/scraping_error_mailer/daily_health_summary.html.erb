<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
    <style>
      body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
      .container { max-width: 600px; margin: 0 auto; padding: 20px; }
      .header { background-color: #17a2b8; color: white; padding: 20px; border-radius: 5px 5px 0 0; }
      .content { background-color: #f8f9fa; padding: 20px; border: 1px solid #dee2e6; }
      .stats { background-color: white; padding: 15px; margin: 15px 0; border-left: 4px solid #17a2b8; }
      .status-good { color: #28a745; }
      .status-bad { color: #dc3545; }
      .status-warn { color: #ffc107; }
      .footer { margin-top: 20px; padding-top: 20px; border-top: 1px solid #dee2e6; font-size: 12px; color: #6c757d; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìä Daily Supplier Health Summary</h1„πú
      </div>
      
      <div class="content">
        <p>Hello,</p>
        
        <p>Here's your daily summary of supplier import activity for <strong><%= Date.current.strftime('%B %d, %Y') %></strong>.</p>
        
        <div class="stats">
          <h3>24-Hour Statistics</h3>
          <ul>
            <li><strong>Total Suppliers:</strong> <%= @summary[:total_suppliers] %></li>
            <li><strong>Active Credentials:</strong> <span class="<%= @summary[:active_credentials] == @summary[:total_suppliers] ? 'status-good' : 'status-warn' %>"><%= @summary[:active_credentials] %>/<%= @summary[:total_suppliers] %></span></li>
            <li><strong>Successful Imports:</strong> <span class="status-good"><%= @summary[:successful_imports_24h] %></span></li>
            <li><strong>Failed Imports:</strong> <span class="<%= @summary[:failed_imports_24h] > 0 ? 'status-bad' : 'status-good' %>"><%= @summary[:failed_imports_24h] %></span></li>
            <li><strong>Success Rate:</strong> <span class="<%= @summary[:success_rate] >= 90 ? 'status-good' : (@summary[:success_rate] >= 70 ? 'status-warn' : 'status-bad') %>"><%= @summary[:success_rate] %>%</span></li>
          </ul>
        </div>

        <% if @failed_imports.any? %>
          <div class="stats" style="border-left-color: #dc3545;">
            <h3>‚ö†Ô∏è Failed Imports (Last 24 Hours)</h3>
            <ul>
              <% @failed_imports.each do |log| %>
                <li>
                  <strong><%= log.supplier.name %></strong> - 
                  <%= log.created_at.strftime('%H:%M') %>
                  <% if log.error_message %>
                    <br/>
                    <small>Error: <%= log.error_message.truncate(100) %></small>
                  <% end %>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>
        
        <div class="footer">
          <p>This is an automated daily summary from SupplierHub.</p>
        </div>
      </div>
    </div>
  </body>
</html>
