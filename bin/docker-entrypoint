#!/bin/bash -e

# Prepare the database (create + migrate if needed)
# With SQLite, both web and worker share the same file, so always prepare
echo "Preparing database..."
./bin/rails db:prepare

# Seed the database if it's empty (first run)
USER_COUNT=$(./bin/rails runner "puts User.count" 2>/dev/null || echo "0")
if [ "$USER_COUNT" == "0" ]; then
  echo "Database is empty, running seeds..."
  ./bin/rails db:seed
fi

exec "${@}"
