#!/bin/bash

echo "=== Entrypoint starting ==="
echo "PROCESS_TYPE=${PROCESS_TYPE:-web}"
echo "RAILS_ENV=${RAILS_ENV:-not set}"
echo "PORT=${PORT:-not set}"
echo "DATABASE_URL is $([ -n "$DATABASE_URL" ] && echo 'set' || echo 'NOT SET')"
echo "SECRET_KEY_BASE is $([ -n "$SECRET_KEY_BASE" ] && echo 'set' || echo 'NOT SET')"

# Run db:migrate only for web process
if [ "${PROCESS_TYPE:-web}" = "web" ]; then
  echo "Running database migrations..."
  ./bin/rails db:migrate 2>&1 || echo "WARNING: Migration failed (exit code $?)"
  echo "Migrations done."
fi

echo "Executing: $@"
exec "${@}"
